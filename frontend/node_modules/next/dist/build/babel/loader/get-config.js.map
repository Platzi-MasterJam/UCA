{"version":3,"sources":["../../../../build/babel/loader/get-config.ts"],"names":["nextDistPath","fileExtensionRegex","getCacheCharacteristics","loaderOptions","source","filename","isServer","pagesDir","isPageFile","startsWith","isNextDist","test","hasModuleExports","indexOf","fileExt","exec","getPlugins","cacheCharacteristics","hasReactRefresh","development","applyCommonJsItem","require","type","reactRefreshItem","skipEnvCheck","noAnonymousDefaultExportItem","pageConfigItem","disallowExportAllItem","transformDefineItem","resolve","nextSsgItem","commonJsItem","filter","Boolean","isJsonFile","isJsFile","getCustomBabelConfig","configFilePath","babelConfigRaw","JSON","parse","Error","getCustomPresets","presets","customConfig","hasNextBabelPreset","preset","Array","isArray","reduce","memo","presetFound","push","getFreshConfig","target","inputSourceMap","hasJsxRuntime","configFile","customPlugins","plugins","options","babelrc","cloneInputAst","undefined","sourceMaps","sourceMap","sourceFileName","overrides","caller","name","supportsStaticESM","supportsDynamicImport","supportsTopLevelAwait","isDev","Object","defineProperty","enumerable","writable","value","reason","emitWarning","loadedOptions","config","getCacheKey","flags","configCache","Map","getConfig","cacheKey","has","cachedConfig","get","cwd","root","freshConfig","call","set"],"mappings":"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","sourcesContent":["import { readFileSync } from 'fs'\n\nimport { createConfigItem, loadOptions } from 'next/dist/compiled/babel/core'\nimport loadConfig from 'next/dist/compiled/babel/core-lib-config'\n\nimport { NextBabelLoaderOptions, NextJsLoaderContext } from './types'\nimport { consumeIterator } from './util'\n\nconst nextDistPath = /(next[\\\\/]dist[\\\\/]next-server[\\\\/]lib)|(next[\\\\/]dist[\\\\/]client)|(next[\\\\/]dist[\\\\/]pages)/\n\n/**\n * The properties defined here are the conditions with which subsets of inputs\n * can be identified that are able to share a common Babel config.  For example,\n * in dev mode, different transforms must be applied to a source file depending\n * on whether you're compiling for the client or for the server - thus `isServer`\n * is germane.\n *\n * However, these characteristics need not protect against circumstances that\n * will not be encountered in Next.js.  For example, a source file may be\n * transformed differently depending on whether we're doing a production compile\n * or for HMR in dev mode.  However, those two circumstances will never be\n * encountered within the context of a single V8 context (and, thus, shared\n * cache).  Therefore, hasReactRefresh is _not_ germane to caching.\n *\n * NOTE: This approach does not support multiple `.babelrc` files in a\n * single project.  A per-cache-key config will be generated once and,\n * if `.babelrc` is present, that config will be used for any subsequent\n * transformations.\n */\ninterface CharacteristicsGermaneToCaching {\n  isServer: boolean\n  isPageFile: boolean\n  isNextDist: boolean\n  hasModuleExports: boolean\n  fileExt: string\n}\n\nconst fileExtensionRegex = /\\.([a-z]+)$/\nfunction getCacheCharacteristics(\n  loaderOptions: NextBabelLoaderOptions,\n  source: string,\n  filename: string\n): CharacteristicsGermaneToCaching {\n  const { isServer, pagesDir } = loaderOptions\n  const isPageFile = filename.startsWith(pagesDir)\n  const isNextDist = nextDistPath.test(filename)\n  const hasModuleExports = source.indexOf('module.exports') !== -1\n  const fileExt = fileExtensionRegex.exec(filename)?.[1] || 'unknown'\n\n  return {\n    isServer,\n    isPageFile,\n    isNextDist,\n    hasModuleExports,\n    fileExt,\n  }\n}\n\n/**\n * Return an array of Babel plugins, conditioned upon loader options and\n * source file characteristics.\n */\nfunction getPlugins(\n  loaderOptions: NextBabelLoaderOptions,\n  cacheCharacteristics: CharacteristicsGermaneToCaching\n) {\n  const {\n    isServer,\n    isPageFile,\n    isNextDist,\n    hasModuleExports,\n  } = cacheCharacteristics\n\n  const { hasReactRefresh, development } = loaderOptions\n\n  const applyCommonJsItem = hasModuleExports\n    ? createConfigItem(require('../plugins/commonjs'), { type: 'plugin' })\n    : null\n  const reactRefreshItem = hasReactRefresh\n    ? createConfigItem(\n        [require('react-refresh/babel'), { skipEnvCheck: true }],\n        { type: 'plugin' }\n      )\n    : null\n  const noAnonymousDefaultExportItem =\n    hasReactRefresh && !isServer\n      ? createConfigItem(\n          [require('../plugins/no-anonymous-default-export'), {}],\n          { type: 'plugin' }\n        )\n      : null\n  const pageConfigItem =\n    !isServer && isPageFile\n      ? createConfigItem([require('../plugins/next-page-config')], {\n          type: 'plugin',\n        })\n      : null\n  const disallowExportAllItem =\n    !isServer && isPageFile\n      ? createConfigItem(\n          [require('../plugins/next-page-disallow-re-export-all-exports')],\n          { type: 'plugin' }\n        )\n      : null\n  const transformDefineItem = createConfigItem(\n    [\n      require.resolve('next/dist/compiled/babel/plugin-transform-define'),\n      {\n        'process.env.NODE_ENV': development ? 'development' : 'production',\n        'typeof window': isServer ? 'undefined' : 'object',\n        'process.browser': isServer ? false : true,\n      },\n      'next-js-transform-define-instance',\n    ],\n    { type: 'plugin' }\n  )\n  const nextSsgItem =\n    !isServer && isPageFile\n      ? createConfigItem([require.resolve('../plugins/next-ssg-transform')], {\n          type: 'plugin',\n        })\n      : null\n  const commonJsItem = isNextDist\n    ? createConfigItem(\n        require('next/dist/compiled/babel/plugin-transform-modules-commonjs'),\n        { type: 'plugin' }\n      )\n    : null\n\n  return [\n    noAnonymousDefaultExportItem,\n    reactRefreshItem,\n    pageConfigItem,\n    disallowExportAllItem,\n    applyCommonJsItem,\n    transformDefineItem,\n    nextSsgItem,\n    commonJsItem,\n  ].filter(Boolean)\n}\n\nconst isJsonFile = /\\.(json|babelrc)$/\nconst isJsFile = /\\.js$/\n\n/**\n * While this function does block execution while reading from disk, it\n * should not introduce any issues.  The function is only invoked when\n * generating a fresh config, and only a small handful of configs should\n * be generated during compilation.\n */\nfunction getCustomBabelConfig(configFilePath: string) {\n  if (isJsonFile.exec(configFilePath)) {\n    const babelConfigRaw = readFileSync(configFilePath, 'utf8')\n    return JSON.parse(babelConfigRaw)\n  } else if (isJsFile.exec(configFilePath)) {\n    return require(configFilePath)\n  }\n  throw new Error(\n    'The Next Babel loader does not support MJS or CJS config files.'\n  )\n}\n\nfunction getCustomPresets(presets: any[], customConfig: any) {\n  presets = [...presets, ...customConfig?.presets]\n\n  const hasNextBabelPreset = (customConfig?.presets || [])\n    .filter((preset: any) => {\n      return (\n        preset === 'next/babel' ||\n        (Array.isArray(preset) && preset[0] === 'next/babel')\n      )\n    })\n    .reduce((memo: boolean, presetFound: boolean) => memo || presetFound, false)\n\n  if (!hasNextBabelPreset) {\n    presets.push('next/babel')\n  }\n\n  return presets\n}\n\n/**\n * Generate a new, flat Babel config, ready to be handed to Babel-traverse.\n * This config should have no unresolved overrides, presets, etc.\n */\nfunction getFreshConfig(\n  this: NextJsLoaderContext,\n  cacheCharacteristics: CharacteristicsGermaneToCaching,\n  loaderOptions: NextBabelLoaderOptions,\n  target: string,\n  filename: string,\n  inputSourceMap?: object | null\n) {\n  let {\n    presets = [],\n    isServer,\n    pagesDir,\n    development,\n    hasJsxRuntime,\n    configFile,\n  } = loaderOptions\n\n  let customPlugins = []\n  if (configFile) {\n    const customConfig = getCustomBabelConfig(configFile)\n    presets = getCustomPresets(presets, customConfig)\n    if (customConfig.plugins) {\n      customPlugins = customConfig.plugins\n    }\n  } else {\n    presets = [...presets, 'next/babel']\n  }\n\n  let options = {\n    babelrc: false,\n    cloneInputAst: false,\n    filename,\n    inputSourceMap: inputSourceMap || undefined,\n\n    // Set the default sourcemap behavior based on Webpack's mapping flag,\n    // but allow users to override if they want.\n    sourceMaps:\n      loaderOptions.sourceMaps === undefined\n        ? this.sourceMap\n        : loaderOptions.sourceMaps,\n\n    // Ensure that Webpack will get a full absolute path in the sourcemap\n    // so that it can properly map the module back to its internal cached\n    // modules.\n    sourceFileName: filename,\n\n    plugins: [\n      ...getPlugins(loaderOptions, cacheCharacteristics),\n      ...customPlugins,\n    ],\n\n    presets,\n\n    overrides: loaderOptions.overrides,\n\n    caller: {\n      name: 'next-babel-turbo-loader',\n      supportsStaticESM: true,\n      supportsDynamicImport: true,\n\n      // Provide plugins with insight into webpack target.\n      // https://github.com/babel/babel-loader/issues/787\n      target: target,\n\n      // Webpack 5 supports TLA behind a flag. We enable it by default\n      // for Babel, and then webpack will throw an error if the experimental\n      // flag isn't enabled.\n      supportsTopLevelAwait: true,\n\n      isServer,\n      pagesDir,\n      isDev: development,\n      hasJsxRuntime,\n\n      ...loaderOptions.caller,\n    },\n  } as any\n\n  Object.defineProperty(options.caller, 'onWarning', {\n    enumerable: false,\n    writable: false,\n    value: (reason: any) => {\n      if (!(reason instanceof Error)) {\n        reason = new Error(reason)\n      }\n      this.emitWarning(reason)\n    },\n  })\n\n  const loadedOptions = loadOptions(options)\n  const config = consumeIterator(loadConfig(loadedOptions))\n\n  return config\n}\n\n/**\n * Each key returned here corresponds with a Babel config that can be shared.\n * The conditions of permissible sharing between files is dependent on specific\n * file attributes and Next.js compiler states: `CharacteristicsGermaneToCaching`.\n */\nfunction getCacheKey(cacheCharacteristics: CharacteristicsGermaneToCaching) {\n  const {\n    isServer,\n    isPageFile,\n    isNextDist,\n    hasModuleExports,\n    fileExt,\n  } = cacheCharacteristics\n\n  const flags =\n    0 |\n    (isServer ? 0b0001 : 0) |\n    (isPageFile ? 0b0010 : 0) |\n    (isNextDist ? 0b0100 : 0) |\n    (hasModuleExports ? 0b1000 : 0)\n\n  return fileExt + flags\n}\n\ntype BabelConfig = any\nconst configCache: Map<any, BabelConfig> = new Map()\n\nexport default function getConfig(\n  this: NextJsLoaderContext,\n  {\n    source,\n    loaderOptions,\n    target,\n    filename,\n    inputSourceMap,\n  }: {\n    source: string\n    loaderOptions: NextBabelLoaderOptions\n    target: string\n    filename: string\n    inputSourceMap?: object | null\n  }\n): BabelConfig {\n  const cacheCharacteristics = getCacheCharacteristics(\n    loaderOptions,\n    source,\n    filename\n  )\n\n  const cacheKey = getCacheKey(cacheCharacteristics)\n  if (configCache.has(cacheKey)) {\n    const cachedConfig = configCache.get(cacheKey)\n\n    return {\n      ...cachedConfig,\n      options: {\n        ...cachedConfig.options,\n        cwd: loaderOptions.cwd,\n        root: loaderOptions.cwd,\n        filename,\n        sourceFileName: filename,\n      },\n    }\n  }\n\n  const freshConfig = getFreshConfig.call(\n    this,\n    cacheCharacteristics,\n    loaderOptions,\n    target,\n    filename,\n    inputSourceMap\n  )\n\n  configCache.set(cacheKey, freshConfig)\n\n  return freshConfig\n}\n"]}